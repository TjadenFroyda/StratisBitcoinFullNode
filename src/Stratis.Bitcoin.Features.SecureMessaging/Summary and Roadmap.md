## Summary and Roadmap
At first this project started out as an [SDF Bounty](http://stratisdevelopmentfoundation.com/bounties/) for using ECDH to implement secure messaging built on the Stratis Full Node. A similar Proof of Concept was developed for NEO as described [here](https://medium.com/proof-of-working/encrypted-messaging-on-the-neo-blockchain-631bbfcf99f6). As I dug into the bounty, I realized how easy it was to build upon the Stratis Full Node and began to lay a framework to turn this bounty into a fully functional secure messaging DApp built on the Stratis blockchain. "Blockchain made easy" is true; the underlying C# backbone really does make a difference! 

If I can do this, imagine what can be made by more capable hands...

-[@TjadenFroyda](http://www.twitter.com/TjadenFroyda)

### Current State
#### SFN Modfications
- Converted getrawtransaction RPC call to API call for the Stratis Full Node.

*Status: PR submitted.*

#### SymmetricEncryption Class
- AES shared secret encryption/decryption algorithm.  

*Status: Completed.*

#### SecureMessaging Class
- **SetSharedSecretPrivateKey:** Generates a shared secret from an internal private key and external public key. 
- **Encrypt:** Encrypts a plaintext message using ECDH shared secret + AES
- **Decrypt:** Decrypts a plaintext message using ECDH shared secret + AES
- **buildOPReturnMessageList:** Compresses the message string before sending it for batch preparation.
- **prepareOPReturnMessageList:** Creates a batch of 38-40 byte chunks to send as OP_Returns.
  - **TODO:** Because transactions are not added to the chain in the order they are received, messages longer than 40 bytes will need to have an ordering byte prefix. This method needs to be modified to do nothing for compressed, encrypted messages less than 40 bytes, prefix a single byte for messages more than 40 bytes but less than 256*39=9984 bytes and two bytes for larger messages up to 65536*38=2490368 bytes in size.
- **Not Implemented/TODO:**
  - Decompression, reassembly, and decryption of batched encrypted messages. 

*Status: ~80% Complete*

#### SecureMessagingController Class
- **MessageAction:** Used for reflection of encrypted/decrypted messages through the API
- **RecoverWalletFromSeed:** Will generate a full wallet based on the shared secret key. Because of BIP 32, this would ensure that both Alice and Bob would be able to import and watch the same addresses for message sending. To preserve security, they should not send to the same address to prevent linking of accounts by external people. Instead, they should send to distinct addresses generated by the HD wallet. 
  - **TODO:** Since the wallet used for messaging should not be used for funds (shared seed), would like to create a new "Conversation" class that will be a stripped down version of Stratis's watch-only wallet that only keeps track of OP_Returns for watched addresses. Will also limit the number of watched HD generated addresses to about 4-5 per party (8-10 total). 
- **GetPrivateMessagingPubKey:** Generates the publickey to share with the other party during handshake
- **GetSecureMessageTransactionCost:** Calculates the cost of the message being sent using the API's cost function
- **BuildAndSendTransactionBatch:** Prepares, builds, and sends a message using the SFN API. 
  - **TODO:** Add final check to ensure that funds are adequate given the size of the message.

*Status: 80% complete.*

#### SecureMessagingControllerEndpoints
- **encrypt-message:** message reflection
- **decrypt-message:** message reflection
- **get-transaction-cost:** Calculates the cost of sending the message. 
- **build-secure-message:** Builds the secure message batch, but does not send. Use for error checking before sending. 
- **get-securemessaging-publickey:** Retrieves the publickey to be used at handshake, derived from the wallet's private key. 
- **retrieve-message: TODO.** Retrieves a messages from an address, decrypts and decompresses into plaintext. 

*Status: 85% done.*

#### Conversation Class
The goal of this class is to create a pared down version of a watch-only-wallet that only tracks addresses and captures associated OP_Returns.
- May need to create associated "ConversationManager" and "ConversationController" classes to capture intended functionality. 

*Status: <5% done.*

#### Overall TODO 
- Add logging and improve clarity of comments throughout (most autogenerated so far). 
- Add error handling for API inputs and associated tests to ensure normal behavior. 
- Conversations class

#### Ideas for future directions
- Build OP_Return indexing into the block repository. These would be a subset of the transaction index and would be an alternative to the Azure block explorer bounty.
  - To consider this approach if the Conversations watch-only wallet is difficult to implement. 
- Build "Contacts" class and associated methods for creating and saving a named contact and their pubkey. Would be useful for generating a MVC interface.
- MVC messenger service interface. 


